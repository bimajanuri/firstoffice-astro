---
import BaseLayout from "../layouts/BaseLayout.astro";
import CityCard from "../components/CityCard.astro";
import OfficeCard from "../components/OfficeCard.astro";

import cities from "../data/cities.json";
import offices from "../data/offices.json";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";

// Hero Assets
import bannerImage from "../assets/images/backgrounds/banner.webp";

// Logos
import teslaLogo from "../assets/images/logos/TESLA.svg";
import libraLogo from "../assets/images/logos/Libra 2.svg";
import binanceLogo from "../assets/images/logos/Binance logo.svg";
import facebookLogo from "../assets/images/logos/Facebook 7.svg";
import microsoftLogo from "../assets/images/logos/Microsoft 6.svg";

import "swiper/css";

const title = "FirstOffice - Find Your Dream Office";
---

<BaseLayout title={title}>
    <header class="flex flex-col w-full">
        <section
            id="Hero-Banner"
            class="relative flex flex-col lg:block lg:h-[720px] lg:-mb-[93px]"
        >
            <div
                id="Hero-Text"
                class="relative z-10 flex flex-col w-full px-4 mt-8 lg:mt-[70px] lg:ml-[calc((100%-1130px)/2)] lg:w-full lg:max-w-[650px] h-fit rounded-[30px] border border-[#E0DEF7] p-6 lg:p-10 gap-6 lg:gap-[30px] bg-white"
            >
                <div
                    class="flex items-center w-fit rounded-full py-2 px-4 gap-[10px] bg-[#000929]"
                >
                    <Icon name="lucide:crown" class="w-5 h-5 text-white" />
                    <span class="font-semibold text-white text-sm lg:text-base"
                        >Weâ€™ve won top productivity 500 fortunes</span
                    >
                </div>
                <h1
                    class="font-extrabold text-[36px] lg:text-[50px] leading-[46px] lg:leading-[60px]"
                >
                    All Great Offices.<br />Grow Your Business.
                </h1>
                <p
                    class="text-base lg:text-lg leading-7 lg:leading-8 text-[#000929]"
                >
                    The right office can have a better and healthier impact on
                    your work and career growth.
                </p>
                <div
                    class="flex flex-col sm:flex-row items-center gap-4 lg:gap-5"
                >
                    <a
                        href="/browse"
                        class="flex items-center justify-center w-full sm:w-auto rounded-full p-[16px_26px] lg:p-[20px_26px] gap-3 bg-[#0D903A]"
                    >
                        <Icon
                            name="lucide:sliders-horizontal"
                            class="w-6 h-6 lg:w-[30px] lg:h-[30px] text-white"
                        />
                        <span
                            class="font-bold text-lg lg:text-xl leading-[30px] text-[#F7F7FD]"
                            >Explore Now</span
                        >
                    </a>
                    <a
                        href="https://www.youtube.com/watch?v=D0UnqGm_miA&pp=ygUXZHVtbXkgdmlkZW8gZm9yIHdlYnNpdGU%3D"
                        class="flex items-center justify-center w-full sm:w-auto rounded-full border border-[#000929] p-[16px_26px] lg:p-[20px_26px] gap-3 bg-white"
                    >
                        <Icon
                            name="lucide:video"
                            class="w-6 h-6 lg:w-[30px] lg:h-[30px]"
                        />
                        <span
                            class="font-semibold text-lg lg:text-xl leading-[30px]"
                            >Watch Story</span
                        >
                    </a>
                </div>
            </div>

            <!-- Hero Image: Stacked on mobile, Absolute on desktop -->
            <div
                id="Hero-Image"
                class="mt-8 px-4 lg:px-0 lg:mt-0 w-full lg:absolute lg:right-0 lg:top-0 lg:w-[calc(100%-((100%-1130px)/2)-305px)] h-[300px] lg:h-[720px] rounded-[30px] lg:rounded-bl-[40px] overflow-hidden"
            >
                <Image
                    src={bannerImage}
                    class="w-full h-full object-cover"
                    alt="hero background"
                    loading="eager"
                    widths={[640, 768, 1024, 1280]}
                    sizes="(max-width: 1024px) 100vw, 50vw"
                    fetchpriority="high"
                />
            </div>
        </section>

        <!-- Stats Section -->
        <div
            class="flex flex-col pt-10 pb-10 px-4 lg:pt-[150px] lg:px-[120px] gap-10 bg-[#0D903A]"
        >
            <div
                class="logo-contianer flex items-center justify-center flex-wrap w-full max-w-[1130px] mx-auto gap-8 lg:gap-[60px]"
            >
                <Image
                    src={teslaLogo}
                    alt="clients logo"
                    class="h-6 lg:h-auto object-contain"
                />
                <Image
                    src={libraLogo}
                    alt="clients logo"
                    class="h-6 lg:h-auto object-contain"
                />
                <Image
                    src={binanceLogo}
                    alt="clients logo"
                    class="h-6 lg:h-auto object-contain"
                />
                <Image
                    src={facebookLogo}
                    alt="clients logo"
                    class="h-6 lg:h-auto object-contain"
                />
                <Image
                    src={microsoftLogo}
                    alt="clients logo"
                    class="h-6 lg:h-auto object-contain"
                />
            </div>
            <div
                class="grid grid-cols-2 md:grid-cols-4 gap-8 lg:gap-[50px] text-center"
            >
                <div class="flex flex-col gap-[2px]">
                    <p class="text-lg lg:text-xl leading-[30px] text-[#F7F7FD]">
                        Comfortable Space
                    </p>
                    <p
                        class="font-bold text-[28px] lg:text-[38px] leading-[40px] lg:leading-[57px] text-white"
                    >
                        580M+
                    </p>
                </div>
                <div class="flex flex-col gap-[2px]">
                    <p class="text-lg lg:text-xl leading-[30px] text-[#F7F7FD]">
                        Startups Succeed
                    </p>
                    <p
                        class="font-bold text-[28px] lg:text-[38px] leading-[40px] lg:leading-[57px] text-white"
                    >
                        98%
                    </p>
                </div>
                <div class="flex flex-col gap-[2px]">
                    <p class="text-lg lg:text-xl leading-[30px] text-[#F7F7FD]">
                        Countries
                    </p>
                    <p
                        class="font-bold text-[28px] lg:text-[38px] leading-[40px] lg:leading-[57px] text-white"
                    >
                        90+
                    </p>
                </div>
                <div class="flex flex-col gap-[2px]">
                    <p class="text-lg lg:text-xl leading-[30px] text-[#F7F7FD]">
                        Supportive Events
                    </p>
                    <p
                        class="font-bold text-[28px] lg:text-[38px] leading-[40px] lg:leading-[57px] text-white"
                    >
                        139M+
                    </p>
                </div>
            </div>
        </div>
    </header>

    <section
        id="Cities"
        class="flex flex-col gap-[30px] mt-10 lg:mt-[100px] px-4"
    >
        <div
            class="w-full max-w-screen-xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 sm:gap-0"
        >
            <h2
                class="font-bold text-[28px] lg:text-[32px] leading-[40px] lg:leading-[48px] text-center sm:text-left text-nowrap"
            >
                You Can Choose <br />Our Favorite Cities
            </h2>
            <a href="#" class="rounded-full py-3 px-5 bg-white font-bold">
                Explore All City
            </a>
        </div>
        <div class="swiper w-full">
            <div class="swiper-wrapper">
                {
                    cities.map((city) => (
                        <div class="swiper-slide !w-fit first-of-type:pl-[calc((100%_-_1130px_-_60px)_/_2)] last-of-type:pr-[calc((100%_-_1130px_-_60px)_/_2)]">
                            <CityCard city={city} />
                        </div>
                    ))
                }
            </div>
        </div>
    </section>

    <section
        id="Benefits"
        class="flex flex-col lg:flex-row items-center justify-center w-full max-w-screen-xl mx-auto gap-10 lg:gap-[100px] mt-10 lg:mt-[100px] px-4"
    >
        <h2
            class="font-bold text-[28px] lg:text-[32px] leading-[40px] lg:leading-[48px] text-center lg:text-left text-nowrap"
        >
            We Might Good <br />For Your Business
        </h2>
        <div
            class="grid grid-cols-1 md:grid-cols-2 gap-[30px] w-full lg:w-auto"
        >
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center justify-center shrink-0 w-[70px] h-[70px] rounded-[23px] bg-white overflow-hidden"
                >
                    <Icon name="lucide:user-check" class="w-[34px] h-[34px]" />
                </div>
                <div class="flex flex-col gap-[5px]">
                    <p class="font-bold text-lg leading-[27px]">
                        Privacy-First Design
                    </p>
                    <p class="text-sm leading-[24px]">
                        Soundproof glass and private zones ensure your
                        conversations stay confidential.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center justify-center shrink-0 w-[70px] h-[70px] rounded-[23px] bg-white overflow-hidden"
                >
                    <Icon name="lucide:users" class="w-[34px] h-[34px]" />
                </div>
                <div class="flex flex-col gap-[5px]">
                    <p class="font-bold text-lg leading-[27px]">
                        Easy Move Access
                    </p>
                    <p class="text-sm leading-[24px]">
                        Located near major transport hubs for effortless
                        commuting and client visits.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center justify-center shrink-0 w-[70px] h-[70px] rounded-[23px] bg-white overflow-hidden"
                >
                    <Icon name="lucide:box" class="w-[34px] h-[34px]" />
                </div>
                <div class="flex flex-col gap-[5px]">
                    <p class="font-bold text-lg leading-[27px]">
                        Flexibility Spaces
                    </p>
                    <p class="text-sm leading-[24px]">
                        Scale up or down easily with adaptable layouts that grow
                        with your team.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center justify-center shrink-0 w-[70px] h-[70px] rounded-[23px] bg-white overflow-hidden"
                >
                    <Icon name="lucide:trophy" class="w-[34px] h-[34px]" />
                </div>
                <div class="flex flex-col gap-[5px]">
                    <p class="font-bold text-lg leading-[27px]">
                        Top-Rated Office
                    </p>
                    <p class="text-sm leading-[24px]">
                        Voted best-in-class for amenities, design, and
                        professional community.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center justify-center shrink-0 w-[70px] h-[70px] rounded-[23px] bg-white overflow-hidden"
                >
                    <Icon name="lucide:coffee" class="w-[34px] h-[34px]" />
                </div>
                <div class="flex flex-col gap-[5px]">
                    <p class="font-bold text-lg leading-[27px]">
                        Extra Snacks Available
                    </p>
                    <p class="text-sm leading-[24px]">
                        Unlimited premium coffee, tea, and healthy snacks to
                        keep you fueled all day.
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center justify-center shrink-0 w-[70px] h-[70px] rounded-[23px] bg-white overflow-hidden"
                >
                    <Icon name="lucide:trending-up" class="w-[34px] h-[34px]" />
                </div>
                <div class="flex flex-col gap-[5px]">
                    <p class="font-bold text-lg leading-[27px]">
                        Sustain for Business
                    </p>
                    <p class="text-sm leading-[24px]">
                        Eco-friendly environments designed for long-term
                        productivity and growth.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section
        id="Fresh-Space"
        class="flex flex-col gap-[30px] w-full max-w-screen-xl mx-auto mt-10 lg:mt-[100px] mb-10 lg:mb-[120px] px-4"
    >
        <div class="flex flex-col gap-4">
            <div
                class="flex flex-col md:flex-row items-center justify-between gap-4"
            >
                <h2
                    class="font-bold text-[28px] lg:text-[32px] leading-[40px] lg:leading-[48px] text-nowrap text-center"
                >
                    Browse Our Fresh Space.<br />For Your Better Productivity.
                </h2>
                <div class="flex items-center gap-3">
                    <span class="text-[#000929] font-medium">Sort by:</span>
                    <div class="relative">
                        <select
                            id="sort-select"
                            class="appearance-none bg-white border border-[#E0DEF7] rounded-full px-5 py-3 pr-10 text-[#000929] font-semibold focus:outline-none focus:ring-2 focus:ring-[#0D903A] cursor-pointer"
                            aria-label="Sort by"
                        >
                            <option value="recommended">Recommended</option>
                            <option value="price-low">Lowest Price</option>
                            <option value="price-high">Highest Price</option>
                            <option value="rating">Highest Rating</option>
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-[#000929]"
                        >
                            <Icon name="lucide:chevron-down" class="w-4 h-4" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 p-5 rounded-[20px] border border-[#E0DEF7] bg-white"
            >
                <!-- City Filter -->
                <div class="flex flex-col gap-2">
                    <label for="filter-city" class="font-bold text-[#000929]"
                        >City</label
                    >
                    <div class="relative">
                        <select
                            id="filter-city"
                            class="w-full appearance-none bg-white border border-[#E0DEF7] rounded-full px-4 py-2 pr-10 text-[#000929] font-medium focus:outline-none focus:ring-2 focus:ring-[#0D903A] cursor-pointer"
                        >
                            <option value="">All Cities</option>
                            {
                                cities.map((city) => (
                                    <option value={city.name}>
                                        {city.name}
                                    </option>
                                ))
                            }
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-[#000929]"
                        >
                            <Icon name="lucide:chevron-down" class="w-4 h-4" />
                        </div>
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="flex flex-col gap-2">
                    <label
                        for="filter-category"
                        class="font-bold text-[#000929]">Category</label
                    >
                    <div class="relative">
                        <select
                            id="filter-category"
                            class="w-full appearance-none bg-white border border-[#E0DEF7] rounded-full px-4 py-2 pr-10 text-[#000929] font-medium focus:outline-none focus:ring-2 focus:ring-[#0D903A] cursor-pointer"
                        >
                            <option value="">All Categories</option>
                            <option value="Serviced Office"
                                >Serviced Office</option
                            >
                            <option value="Virtual Office"
                                >Virtual Office</option
                            >
                            <option value="Managed Office"
                                >Managed Office</option
                            >
                            <option value="Shell and Core">Shell & Core</option>
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-[#000929]"
                        >
                            <Icon name="lucide:chevron-down" class="w-4 h-4" />
                        </div>
                    </div>
                </div>

                <!-- Price Filter -->
                <div class="flex flex-col gap-2">
                    <label for="filter-price" class="font-bold text-[#000929]"
                        >Max Price</label
                    >
                    <div class="relative">
                        <select
                            id="filter-price"
                            class="w-full appearance-none bg-white border border-[#E0DEF7] rounded-full px-4 py-2 pr-10 text-[#000929] font-medium focus:outline-none focus:ring-2 focus:ring-[#0D903A] cursor-pointer"
                        >
                            <option value="">Any Price</option>
                            <option value="10000000">&lt; Rp 10.000.000</option>
                            <option value="20000000">&lt; Rp 20.000.000</option>
                            <option value="50000000">&lt; Rp 50.000.000</option>
                            <option value="100000000"
                                >&lt; Rp 100.000.000</option
                            >
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-[#000929]"
                        >
                            <Icon name="lucide:chevron-down" class="w-4 h-4" />
                        </div>
                    </div>
                </div>

                <!-- Rating Filter -->
                <div class="flex flex-col gap-2">
                    <label for="filter-rating" class="font-bold text-[#000929]"
                        >Rating</label
                    >
                    <div class="relative">
                        <select
                            id="filter-rating"
                            class="w-full appearance-none bg-white border border-[#E0DEF7] rounded-full px-4 py-2 pr-10 text-[#000929] font-medium focus:outline-none focus:ring-2 focus:ring-[#0D903A] cursor-pointer"
                        >
                            <option value="">Any Rating</option>
                            <option value="4.5">4.5+ Stars</option>
                            <option value="4">4+ Stars</option>
                            <option value="3">3+ Stars</option>
                        </select>
                        <div
                            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-[#000929]"
                        >
                            <Icon name="lucide:chevron-down" class="w-4 h-4" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div
            id="office-grid"
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-[30px]"
        >
            {
                offices.map((office, index) => (
                    <div
                        class={`office-card-item ${index >= 9 ? "hidden" : ""}`}
                        data-price={office.price}
                        data-rating={office.rating}
                        data-location={office.location}
                        data-category={office.category}
                    >
                        <OfficeCard office={office} />
                    </div>
                ))
            }
        </div>

        {
            offices.length > 9 && (
                <div id="load-more-container" class="flex justify-center mt-10">
                    <button
                        id="load-more-btn"
                        class="px-8 py-4 bg-white border border-[#E0DEF7] rounded-full font-bold text-[#000929] hover:bg-gray-50 transition-colors"
                    >
                        View More Offices
                    </button>
                    <p
                        id="no-results-msg"
                        class="hidden text-center text-xl text-gray-500"
                    >
                        No offices found matching your filters.
                    </p>
                </div>
            )
        }
    </section>

    <script>
        import Swiper from "swiper";
        import "swiper/css";

        let swiperInstance = null;

        function initSwiper() {
            if (swiperInstance) {
                swiperInstance.destroy(true, true);
            }

            swiperInstance = new Swiper(".swiper", {
                // Optional parameters
                direction: "horizontal",
                spaceBetween: 30,
                slidesPerView: "auto",
                slidesOffsetAfter: 30,
                slidesOffsetBefore: 30,
                loop: true,
            });
        }

        document.addEventListener("DOMContentLoaded", initSwiper);
        document.addEventListener("astro:page-load", initSwiper);

        // Sorting, Filtering & Load More Logic
        const sortSelect = document.getElementById(
            "sort-select",
        ) as HTMLSelectElement;
        const officeGrid = document.getElementById("office-grid");
        const loadMoreBtn = document.getElementById("load-more-btn");
        const loadMoreContainer = document.getElementById(
            "load-more-container",
        );
        const noResultsMsg = document.getElementById("no-results-msg");

        const filterCity = document.getElementById(
            "filter-city",
        ) as HTMLSelectElement;
        const filterCategory = document.getElementById(
            "filter-category",
        ) as HTMLSelectElement;
        const filterPrice = document.getElementById(
            "filter-price",
        ) as HTMLSelectElement;
        const filterRating = document.getElementById(
            "filter-rating",
        ) as HTMLSelectElement;

        let visibleCount = 9;
        const ITEMS_PER_PAGE = 9;

        if (
            sortSelect &&
            officeGrid &&
            filterCity &&
            filterCategory &&
            filterPrice &&
            filterRating
        ) {
            const cards = Array.from(
                officeGrid.querySelectorAll(".office-card-item"),
            ) as HTMLElement[];

            // Store original order implicitly/explicity if needed?
            // "Recommended" implies original order.
            // Since we re-append, original DOM order is lost.
            // We should keep a reference to original order or just rely on 'cards' array order which is static.

            const parsePrice = (priceStr: string) => {
                if (!priceStr) return 0;
                return parseInt(priceStr.replace(/[^0-9]/g, ""));
            };

            const filterSortAndRender = () => {
                const criteria = sortSelect.value;
                const cityFilter = filterCity.value;
                const categoryFilter = filterCategory.value;
                const priceFilter = filterPrice.value;
                const ratingFilter = filterRating.value;

                let processedCards = [...cards];

                // 1. Filter
                if (cityFilter) {
                    processedCards = processedCards.filter(
                        (c) => c.getAttribute("data-location") === cityFilter,
                    );
                }
                if (categoryFilter) {
                    processedCards = processedCards.filter(
                        (c) =>
                            c.getAttribute("data-category") === categoryFilter,
                    );
                }
                if (priceFilter) {
                    const maxPrice = parseInt(priceFilter);
                    processedCards = processedCards.filter(
                        (c) =>
                            parsePrice(c.getAttribute("data-price") || "") <=
                            maxPrice,
                    );
                }
                if (ratingFilter) {
                    const minRating = parseFloat(ratingFilter);
                    processedCards = processedCards.filter(
                        (c) =>
                            parseFloat(c.getAttribute("data-rating") || "0") >=
                            minRating,
                    );
                }

                // 2. Sort
                if (criteria === "price-low") {
                    processedCards.sort((a, b) => {
                        return (
                            parsePrice(a.getAttribute("data-price") || "0") -
                            parsePrice(b.getAttribute("data-price") || "0")
                        );
                    });
                } else if (criteria === "price-high") {
                    processedCards.sort((a, b) => {
                        return (
                            parsePrice(b.getAttribute("data-price") || "0") -
                            parsePrice(a.getAttribute("data-price") || "0")
                        );
                    });
                } else if (criteria === "rating") {
                    processedCards.sort((a, b) => {
                        return (
                            parseFloat(b.getAttribute("data-rating") || "0") -
                            parseFloat(a.getAttribute("data-rating") || "0")
                        );
                    });
                } // default recommended uses original order in 'cards' (which we cloned from)

                // 3. Render / Update Visibility
                // Hide all first? Or just re-append?
                // We need to re-append to sort visually

                if (processedCards.length === 0) {
                    if (noResultsMsg) noResultsMsg.classList.remove("hidden");
                    if (loadMoreBtn) loadMoreBtn.classList.add("hidden");

                    // Hide all cards
                    cards.forEach((c) => c.classList.add("hidden"));
                } else {
                    if (noResultsMsg) noResultsMsg.classList.add("hidden");

                    processedCards.forEach((card, index) => {
                        officeGrid.appendChild(card);
                        if (index < visibleCount) {
                            card.classList.remove("hidden");
                        } else {
                            card.classList.add("hidden");
                        }
                    });

                    // Hide excluded cards (those not in processedCards)
                    // Note: cards - processedCards
                    const processedSet = new Set(processedCards);
                    cards.forEach((card) => {
                        if (!processedSet.has(card)) {
                            card.classList.add("hidden");
                        }
                    });

                    if (loadMoreBtn) {
                        if (visibleCount >= processedCards.length) {
                            loadMoreBtn.classList.add("hidden");
                        } else {
                            loadMoreBtn.classList.remove("hidden");
                        }
                    }
                }
            };

            const onFilterChange = () => {
                // Reset visible count when filters change?
                visibleCount = ITEMS_PER_PAGE;
                filterSortAndRender();
            };

            sortSelect.addEventListener("change", filterSortAndRender);
            filterCity.addEventListener("change", onFilterChange);
            filterCategory.addEventListener("change", onFilterChange);
            filterPrice.addEventListener("change", onFilterChange);
            filterRating.addEventListener("change", onFilterChange);

            if (loadMoreBtn) {
                loadMoreBtn.addEventListener("click", () => {
                    visibleCount += ITEMS_PER_PAGE;
                    filterSortAndRender();
                });
            }
        }
    </script>
</BaseLayout>
